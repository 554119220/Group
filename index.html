<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Group by fucongcong</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/fucongcong/Group">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/fucongcong/Group/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/fucongcong/Group/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Group</h1>
          <p>轻量级框架 ,无缝支持swoole http server。支持redis扩展，swoole扩展的使用，实现了定时任务功能，分布式任务队列，命令行控制台，数据库脚本自动化，单元测试, rpc服务，异步多进程服务等等实用的功能！！ 欢迎提交代码！</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/fucongcong">fucongcong</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <h1>
<a id="-group" class="anchor" href="#-group" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a># Group</h1>

<p><a href="https://codeclimate.com/github/fucongcong/framework"><img src="https://codeclimate.com/github/fucongcong/framework/badges/gpa.svg" alt="Code Climate"></a>
<a href="https://travis-ci.org/fucongcong/Group"><img src="https://travis-ci.org/fucongcong/Group.svg?branch=master" alt="Build Status"></a></p>

<h4>
<a id="编写此框架的意义" class="anchor" href="#%E7%BC%96%E5%86%99%E6%AD%A4%E6%A1%86%E6%9E%B6%E7%9A%84%E6%84%8F%E4%B9%89" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>编写此框架的意义:</h4>

<p>首先现在流行的框架有很多。编写这个框架，其实可以说这个框架的特色，与其他框架的区别。</p>

<ul>
<li>支持普通业务场景的功能开发，4层架构。</li>
<li>一键启动rpc服务，不与主业务冲突，轻松完成后期SOA转行，支持TCP HTTP Websocket协议</li>
<li>一键启动定时任务，还在用系统自带的cronjob？</li>
<li>一键启动队列任务，还在自己集成队列服务？</li>
<li>async多task处理任务支持，业务逻辑复杂性能差？多进程帮你解决性能问题！</li>
<li>目录结构清晰简单</li>
<li>轻量级。框架的实际代码目前应该在5千行左右</li>
<li>包管理composer支持。</li>
<li>架构可扩展性，规范的命名空间化，自己扩展类库随时可行</li>
<li>Debug工具条支持，找性能问题？找你的sql哪里慢了？找视图层渲染变量？找模板？debug条一览无余</li>
<li>laravel,symfony2有的控制台，我们也有！数据库脚本自动化！自动生成基础结构！自定义扩展控制台！</li>
</ul>

<h5>
<a id="使用swoole-http-server" class="anchor" href="#%E4%BD%BF%E7%94%A8swoole-http-server" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://github.com/fucongcong/ssos/blob/master/php/group%E6%A1%86%E6%9E%B6%E6%B5%8B%E8%AF%95.md">使用swoole http server</a>
</h5>

<h5>
<a id="未来版本开发计划" class="anchor" href="#%E6%9C%AA%E6%9D%A5%E7%89%88%E6%9C%AC%E5%BC%80%E5%8F%91%E8%AE%A1%E5%88%92" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>未来版本开发计划：</h5>

<ul>
<li>Async服务完善。解决数据层断线重连，业务层内存泄漏等常见问题</li>
<li>更轻量级化数据层与服务层</li>
<li>i18n支持</li>
<li>一些常用类库的丰富（中文转拼音，验证码，校验，过滤xss，tag...）</li>
</ul>

<p>轻量级框架，通俗易懂，快速上手。
觉得帮到您了点击右上star!给我一点动力！
PHP交流ＱＱ群：390536187</p>

<h4>
<a id="1group框架简介" class="anchor" href="#1group%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1.<a href="#user-content-group%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B">Group框架简介</a>
</h4>

<ul>
<li><a href="#user-content-%E6%A1%86%E6%9E%B6%E4%BB%8B%E7%BB%8D">后端框架介绍</a></li>
</ul>

<h4>
<a id="2快速开始" class="anchor" href="#2%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2.<a href="#user-content-%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B">快速开始</a>
</h4>

<ul>
<li><a href="#user-content-1%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">服务器配置文件</a></li>
<li><a href="#user-content-2%E8%BF%9B%E5%85%A5%E6%A1%86%E6%9E%B6">进入框架</a></li>
<li><a href="#user-content-3%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84">目录结构</a></li>
</ul>

<h4>
<a id="3路由篇" class="anchor" href="#3%E8%B7%AF%E7%94%B1%E7%AF%87" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3.<a href="#user-content-%E8%B7%AF%E7%94%B1%E7%AF%87">路由篇</a>
</h4>

<h4>
<a id="4控制层" class="anchor" href="#4%E6%8E%A7%E5%88%B6%E5%B1%82" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>4.<a href="#user-content-%E6%8E%A7%E5%88%B6%E5%B1%82">控制层</a>
</h4>

<h4>
<a id="5服务层" class="anchor" href="#5%E6%9C%8D%E5%8A%A1%E5%B1%82" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>5.<a href="#user-content-%E6%9C%8D%E5%8A%A1%E5%B1%82">服务层</a>
</h4>

<h4>
<a id="6数据层" class="anchor" href="#6%E6%95%B0%E6%8D%AE%E5%B1%82" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>6.<a href="#user-content-%E6%95%B0%E6%8D%AE%E5%B1%82">数据层</a>
</h4>

<h4>
<a id="7视图层" class="anchor" href="#7%E8%A7%86%E5%9B%BE%E5%B1%82" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>7.<a href="#user-content-%E8%A7%86%E5%9B%BE%E5%B1%82">视图层</a>
</h4>

<h4>
<a id="8框架基础服务" class="anchor" href="#8%E6%A1%86%E6%9E%B6%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>8.<a href="#user-content-%E6%A1%86%E6%9E%B6%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1">框架基础服务</a>
</h4>

<ul>
<li><a href="#user-content-async">Async</a></li>
<li><a href="#user-content-container">Container</a></li>
<li><a href="#user-content-cache">Cache</a></li>
<li><a href="#user-content-config">Config</a></li>
<li><a href="#user-content-console">Console</a></li>
<li><a href="#user-content-cronjob">CronJob</a></li>
<li><a href="#user-content-debug">Debug</a></li>
<li><a href="#user-content-exception">Exception</a></li>
<li><a href="#user-content-eventdispatcher">EventDispatcher</a></li>
<li><a href="#user-content-filecache">FileCache</a></li>
<li><a href="#user-content-filesystem">Filesystem</a></li>
<li><a href="#user-content-route">Route</a></li>
<li><a href="#user-content-request">Request</a></li>
<li><a href="#user-content-response">Response</a></li>
<li><a href="#user-content-session">Session</a></li>
<li><a href="#user-content-log">Log</a></li>
<li><a href="#user-content-queue">Queue</a></li>
<li><a href="#user-content-test">Test</a></li>
<li><a href="#user-content-rpc">RPC</a></li>
</ul>

<h4>
<a id="9单元测试" class="anchor" href="#9%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>9.<a href="#user-content-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95">单元测试</a>
</h4>

<h2>
<a id="group框架简介" class="anchor" href="#group%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Group框架简介</h2>

<h4>
<a id="环境依赖" class="anchor" href="#%E7%8E%AF%E5%A2%83%E4%BE%9D%E8%B5%96" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>环境依赖</h4>

<ul>
<li>PHP &gt; 5.5</li>
<li>Redis</li>
<li>Mysql</li>
<li>Nginx or Apache</li>
<li>Composer</li>
</ul>

<h4>
<a id="扩展模块" class="anchor" href="#%E6%89%A9%E5%B1%95%E6%A8%A1%E5%9D%97" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>扩展模块</h4>

<ul>
<li><a href="https://github.com/phpredis/phpredis">PhpRedis</a></li>
<li><a href="https://github.com/swoole/swoole-src">Swoole，建议最新版本，1.8.0以上</a></li>
<li>
<a href="https://github.com/kr/beanstalkd">beanstalkd</a> </li>
</ul>

<h4>
<a id="框架介绍" class="anchor" href="#%E6%A1%86%E6%9E%B6%E4%BB%8B%E7%BB%8D" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>框架介绍</h4>

<p>（1）模版引擎：twig （symfony2使用的模版引擎）</p>

<p>（2）分层：Dao（模型层）,Service（服务层），Controller（控制层），View（视图层）</p>

<h2>
<a id="快速开始" class="anchor" href="#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>快速开始</h2>

<h4>
<a id="准备" class="anchor" href="#%E5%87%86%E5%A4%87" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>准备</h4>

<p>进入目录，执行以下命令</p>

<pre><code>git clone https://github.com/fucongcong/Group.git

cd Group

composer install
</code></pre>

<h4>
<a id="更新框架版本部分涉及到配置文件的需要更新git的master最新分支" class="anchor" href="#%E6%9B%B4%E6%96%B0%E6%A1%86%E6%9E%B6%E7%89%88%E6%9C%AC%E9%83%A8%E5%88%86%E6%B6%89%E5%8F%8A%E5%88%B0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E9%9C%80%E8%A6%81%E6%9B%B4%E6%96%B0git%E7%9A%84master%E6%9C%80%E6%96%B0%E5%88%86%E6%94%AF" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>更新框架版本（部分涉及到配置文件的需要更新git的master最新分支）</h4>

<pre><code>composer update
</code></pre>

<h4>
<a id="1服务器配置文件" class="anchor" href="#1%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1.服务器配置文件</h4>

<p><a href="https://github.com/fucongcong/Group/blob/master/doc/ngnix_server_config.txt">Ngnix配置</a>
<a href="https://github.com/fucongcong/Group/blob/master/doc/nginx_proxy&amp;apache.txt">Ngnix&amp;Apache配置</a></p>

<h4>
<a id="2进入框架" class="anchor" href="#2%E8%BF%9B%E5%85%A5%E6%A1%86%E6%9E%B6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2.进入框架</h4>

<p>访问 http://localhost:8081 进入框架主页</p>

<h4>
<a id="3目录结构" class="anchor" href="#3%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3.目录结构</h4>

<ul>
<li>app (脚本文件)</li>
<li>asset (前端文件)</li>
<li>config (配置文件)</li>
<li>doc (文档)</li>
<li>runtime (缓存)</li>
<li>src (你的网站核心代码)

<ul>
<li>Admin (后台分组)

<ul>
<li>Controller （控制层）</li>
<li>View (视图层)</li>
<li>routing.php （路由配置）</li>
</ul>
</li>
<li>Async (异步服务)</li>
<li>Dao （模型层）</li>
<li>Services （服务层）</li>
<li>Web (前台分组)

<ul>
<li>Command (控制台命令扩展)</li>
<li>Controller （控制层）</li>
<li>Cron （异步定时器）</li>
<li>Listeners （监听器）</li>
<li>Queue （队列任务）</li>
<li>View (视图层)</li>
<li>routing.php （路由配置）</li>
</ul>
</li>
<li>Demo（可以自行添加分组）</li>
</ul>
</li>
<li>index.php(主入口)</li>
<li>server.php(swoole http server 入口)</li>
<li>rpc_server.php(rpc server 启动脚本)</li>
</ul>

<h2>
<a id="路由篇" class="anchor" href="#%E8%B7%AF%E7%94%B1%E7%AF%87" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>路由篇</h2>

<p>（1）自定义路由</p>

<p>（2）动态参数绑定</p>

<p>（3）restful API 风格</p>

<p>示例：</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">return</span> <span class="pl-c1">array</span>(</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>homepage<span class="pl-pds">'</span></span><span class="pl-k">=&gt;</span>[</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>pattern<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>controller<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Web:Home:Default:index<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        ],</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>group<span class="pl-pds">'</span></span><span class="pl-k">=&gt;</span>[</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>pattern<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>/group/{id}<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>controller<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Web:Group:Group:test<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>methods<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        ],</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>create_group<span class="pl-pds">'</span></span><span class="pl-k">=&gt;</span>[</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>pattern<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>/group/{id}<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>controller<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Web:Group:Group:index<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>methods<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>POST<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        ],</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>user_group<span class="pl-pds">'</span></span><span class="pl-k">=&gt;</span>[</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>pattern<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>/user/{id}/group/{groupId}<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>controller<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Web:Group:Group:test<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>methods<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        ],</span>
<span class="pl-s1">);</span></pre></div>

<h2>
<a id="控制层" class="anchor" href="#%E6%8E%A7%E5%88%B6%E5%B1%82" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>控制层</h2>

<p>（1）第一个控制器</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">    <span class="pl-k">&lt;</span>?<span class="pl-c1">php</span></span>
<span class="pl-s1">    <span class="pl-k">namespace</span> <span class="pl-en">src\web\Controller\Home</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">use</span> <span class="pl-c1">Controller</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">//请继承Controller</span></span>
<span class="pl-s1">    <span class="pl-k">class</span> <span class="pl-en">DefaultController</span> <span class="pl-k">extends</span> <span class="pl-e">Controller</span></span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-c">//一个action 与route对应</span></span>
<span class="pl-s1">        <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">indexAction</span>()</span>
<span class="pl-s1">        {</span>
<span class="pl-s1">            <span class="pl-c">//渲染模版 模版的启始路径可在config的view.php配置</span></span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-smi">$this</span> <span class="pl-k">-&gt;</span> render(<span class="pl-s"><span class="pl-pds">'</span>Web/Views/Default/index.html.twig<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    </span><span class="pl-pse"><span class="pl-s1">?</span>&gt;</span></pre></div>

<p>（2）如何获取路由传过来的参数？详见Request与Route服务</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">src\Web\Controller\Group</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">Controller</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">Request</span>;</span>
<span class="pl-s1"><span class="pl-c">//在后面我们可以跟上路由定义好的参数，$id</span></span>
<span class="pl-s1"><span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">testAction</span>(<span class="pl-c1">Request</span> <span class="pl-smi">$request</span>, <span class="pl-smi">$id</span>)</span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-c">// echo $id; echo "&lt;br&gt;";</span></span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">//可以获取整个路由地址</span></span>
<span class="pl-s1">    <span class="pl-smi">$uri</span> <span class="pl-k">=</span> <span class="pl-smi">$this</span> <span class="pl-k">-&gt;</span> route() <span class="pl-k">-&gt;</span> getUri();</span>
<span class="pl-s1">    <span class="pl-c">//获取所有参数</span></span>
<span class="pl-s1">    <span class="pl-smi">$parameters</span> <span class="pl-k">=</span> <span class="pl-smi">$this</span> <span class="pl-k">-&gt;</span> route() <span class="pl-k">-&gt;</span> getParameters();</span>
<span class="pl-s1">    <span class="pl-c">//获取参数名</span></span>
<span class="pl-s1">    <span class="pl-smi">$parametersName</span> <span class="pl-k">=</span> <span class="pl-smi">$this</span> <span class="pl-k">-&gt;</span> route() <span class="pl-k">-&gt;</span> getParametersName();</span>
<span class="pl-s1">    <span class="pl-c">//获取当前action的名称</span></span>
<span class="pl-s1">    <span class="pl-smi">$action</span> <span class="pl-k">=</span> <span class="pl-smi">$this</span> <span class="pl-k">-&gt;</span> route() <span class="pl-k">-&gt;</span> getAction();</span>
<span class="pl-s1">    <span class="pl-c">//获取系统支持的请求方法</span></span>
<span class="pl-s1">    <span class="pl-smi">$methods</span> <span class="pl-k">=</span> <span class="pl-smi">$this</span> <span class="pl-k">-&gt;</span> route() <span class="pl-k">-&gt;</span> getMethods();</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-smi">$currentMethod</span> <span class="pl-k">=</span> <span class="pl-smi">$this</span> <span class="pl-k">-&gt;</span> route() <span class="pl-k">-&gt;</span> getCurrentMethod();</span>
<span class="pl-s1">    <span class="pl-c">//获取当前时区</span></span>
<span class="pl-s1">    <span class="pl-smi">$timezone</span> <span class="pl-k">=</span> <span class="pl-smi">$this</span> <span class="pl-k">-&gt;</span> getContainer() <span class="pl-k">-&gt;</span> getTimezone();</span>
<span class="pl-s1">    <span class="pl-c">//获取当前运行环境</span></span>
<span class="pl-s1">    <span class="pl-smi">$environment</span> <span class="pl-k">=</span> <span class="pl-smi">$this</span> <span class="pl-k">-&gt;</span> getContainer() <span class="pl-k">-&gt;</span> getEnvironment();</span>
<span class="pl-s1">    <span class="pl-c">//这里和Service服务层交互</span></span>
<span class="pl-s1">    <span class="pl-c1">echo</span> <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>getGroupService()<span class="pl-k">-&gt;</span>getGroup(<span class="pl-c1">1</span>);</span>
<span class="pl-s1">    <span class="pl-c">//传入模板</span></span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-smi">$this</span> <span class="pl-k">-&gt;</span> render(<span class="pl-s"><span class="pl-pds">'</span>Web/Views/Group/index.html.twig<span class="pl-pds">'</span></span>,<span class="pl-c1">array</span>(</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>uri<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$uri</span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>parameters<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$parameters</span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>parametersName<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$parametersName</span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>action<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$action</span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>methods<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$methods</span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>currentMethod<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$currentMethod</span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>timezone<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$timezone</span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>environment<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$environment</span></span>
<span class="pl-s1">        ));</span>
<span class="pl-s1">}</span>
<span class="pl-s1"><span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">getGroupService</span>()</span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-c">//创建一个Service实例</span></span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-smi">$this</span> <span class="pl-k">-&gt;</span> createService(<span class="pl-s"><span class="pl-pds">"</span>Group:Group<span class="pl-pds">"</span></span>);</span>
<span class="pl-s1">}</span></pre></div>

<h2>
<a id="服务层" class="anchor" href="#%E6%9C%8D%E5%8A%A1%E5%B1%82" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>服务层</h2>

<h5>
<a id="1简单介绍一下目录结构" class="anchor" href="#1%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>（1）简单介绍一下目录结构</h5>

<ul>
<li>Group (示例)

<ul>
<li>Impl （服务层实现的接口）</li>
<li>Rely （定义服务之间的依赖关系）</li>
</ul>
</li>
<li>GroupService.php(接口)</li>
</ul>

<h5>
<a id="服务层主要用于处理数据层与控制层间数据的业务处理只要继承service类就可以了" class="anchor" href="#%E6%9C%8D%E5%8A%A1%E5%B1%82%E4%B8%BB%E8%A6%81%E7%94%A8%E4%BA%8E%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE%E5%B1%82%E4%B8%8E%E6%8E%A7%E5%88%B6%E5%B1%82%E9%97%B4%E6%95%B0%E6%8D%AE%E7%9A%84%E4%B8%9A%E5%8A%A1%E5%A4%84%E7%90%86%E5%8F%AA%E8%A6%81%E7%BB%A7%E6%89%BFservice%E7%B1%BB%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BA%86" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>服务层主要用于处理数据层与控制层间数据的业务处理。只要继承Service类就可以了。</h5>

<pre><code>GroupService.php
</code></pre>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">src\Services\Group</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">interface</span> <span class="pl-en">GroupService</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">getGroup</span>(<span class="pl-smi">$id</span>);</span>
<span class="pl-s1">}</span></pre></div>

<pre><code>/Rely/GroupBaseService.php
</code></pre>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">src\Services\Group\Rely</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">Service</span>;</span>
<span class="pl-s1"><span class="pl-c">//定义在Rely文件下的依赖</span></span>
<span class="pl-s1"><span class="pl-k">abstract</span> <span class="pl-k">class</span> <span class="pl-en">GroupBaseService</span> <span class="pl-k">extends</span> <span class="pl-e">Service</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-c">//获取数据层的对象实例</span></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">getGroupDao</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>createDao(<span class="pl-s"><span class="pl-pds">"</span>Group:Group<span class="pl-pds">"</span></span>);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">//获取其他服务的对象实例</span></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">getUserService</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-smi">$this</span> <span class="pl-k">-&gt;</span> createService(<span class="pl-s"><span class="pl-pds">"</span>User:User<span class="pl-pds">"</span></span>);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">}</span></pre></div>

<pre><code>/Impl/GroupServiceImpl.php
</code></pre>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">src\Services\Group\Impl</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">src\Services\Group\Rely\GroupBaseService</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">src\Services\Group\GroupService</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">GroupServiceImpl</span> <span class="pl-k">extends</span> <span class="pl-e">GroupBaseService</span> <span class="pl-k">implements</span> <span class="pl-e">GroupService</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-c">//实现定义的服务层接口方法</span></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">getGroup</span>(<span class="pl-smi">$id</span>)</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-smi">$this</span> <span class="pl-k">-&gt;</span> getUserService() <span class="pl-k">-&gt;</span> getUser(<span class="pl-c1">1</span>);</span>
<span class="pl-s1">        <span class="pl-c">//return $this-&gt;getGroupDao()-&gt;getGroup($id);</span></span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">}</span></pre></div>

<h2>
<a id="数据层" class="anchor" href="#%E6%95%B0%E6%8D%AE%E5%B1%82" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>数据层</h2>

<h5>
<a id="支持主从配置详见配置文件" class="anchor" href="#%E6%94%AF%E6%8C%81%E4%B8%BB%E4%BB%8E%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>支持主从配置(详见配置文件)</h5>

<h5>
<a id="如何使用" class="anchor" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>如何使用</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">namespace</span> <span class="pl-en">src\Dao\Group\Impl</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">use</span> <span class="pl-c1">Dao</span>;</span>
<span class="pl-s1">    <span class="pl-k">use</span> <span class="pl-c1">src\Dao\Group\GroupDao</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">class</span> <span class="pl-en">GroupDaoImpl</span> <span class="pl-k">extends</span> <span class="pl-e">Dao</span> <span class="pl-k">implements</span> <span class="pl-e">GroupDao</span></span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-c">//定以数据表</span></span>
<span class="pl-s1">        <span class="pl-k">protected</span> <span class="pl-smi">$tables</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>groups<span class="pl-pds">"</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-c">//具体方法</span></span>
<span class="pl-s1">        <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">getGroup</span>(<span class="pl-smi">$id</span>)</span>
<span class="pl-s1">        {</span>
<span class="pl-s1">            <span class="pl-smi">$sql</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-k">SELECT</span> <span class="pl-k">*</span> <span class="pl-k">FROM</span> {<span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">tables</span>} <span class="pl-k">WHERE</span> id<span class="pl-k">=</span>:id <span class="pl-k">LIMIT</span> <span class="pl-c1">0</span>,<span class="pl-c1">1</span></span><span class="pl-pds">"</span></span>;</span>
<span class="pl-s1">            <span class="pl-c">//动态参数绑定</span></span>
<span class="pl-s1">            <span class="pl-smi">$bind</span> <span class="pl-k">=</span> <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$id</span>);</span>
<span class="pl-s1">            <span class="pl-c">//读取默认配置</span></span>
<span class="pl-s1">            <span class="pl-c">//$group = $this-&gt;getDefault()-&gt;fetchOne($sql, $bind);</span></span>
<span class="pl-s1"></span>
<span class="pl-s1">            <span class="pl-c">//读取写服务器配置，如果没有指定具体参数，随机写入分配的服务器</span></span>
<span class="pl-s1">            <span class="pl-c">//$group = $this-&gt;getWrite('master1')-&gt;fetchOne($sql, $bind);</span></span>
<span class="pl-s1">            <span class="pl-c">//$group = $this-&gt;getWrite('master2')-&gt;fetchOne($sql, $bind);</span></span>
<span class="pl-s1"></span>
<span class="pl-s1">            <span class="pl-c">//读取读服务器配置，如果没有指定具体参数，随机读取分配的服务器</span></span>
<span class="pl-s1">            <span class="pl-c">//$group = $this-&gt;getRead()-&gt;fetchOne($sql, $bind);</span></span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-smi">$group</span> ? <span class="pl-smi">$group</span> : <span class="pl-c1">null</span>;</span>
<span class="pl-s1">        }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    }</span></pre></div>

<h5>
<a id="支持的语法" class="anchor" href="#%E6%94%AF%E6%8C%81%E7%9A%84%E8%AF%AD%E6%B3%95" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>支持的语法</h5>

<h5>
<a id="fetch" class="anchor" href="#fetch" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>fetch(*)</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">    <span class="pl-smi">$pdo</span> <span class="pl-k">=</span> <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>getDefault();</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-smi">$stm</span>  <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-s1"><span class="pl-k">SELECT</span> <span class="pl-k">*</span> <span class="pl-k">FROM</span> test <span class="pl-k">WHERE</span> foo <span class="pl-k">=</span> :foo <span class="pl-k">AND</span> bar <span class="pl-k">=</span> :bar</span><span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">    <span class="pl-smi">$bind</span> <span class="pl-k">=</span> <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>baz<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>bar<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>dib<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    <span class="pl-smi">$result</span> <span class="pl-k">=</span> <span class="pl-smi">$pdo</span><span class="pl-k">-&gt;</span>fetchAll(<span class="pl-smi">$stm</span>, <span class="pl-smi">$bind</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// fetchAssoc() returns an associative array of all rows where the key is the</span></span>
<span class="pl-s1">    <span class="pl-c">// first column, and the row arrays are keyed on the column names</span></span>
<span class="pl-s1">    <span class="pl-smi">$result</span> <span class="pl-k">=</span> <span class="pl-smi">$pdo</span><span class="pl-k">-&gt;</span>fetchAssoc(<span class="pl-smi">$stm</span>, <span class="pl-smi">$bind</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// fetchGroup() is like fetchAssoc() except that the values aren't wrapped in</span></span>
<span class="pl-s1">    <span class="pl-c">// arrays. Instead, single column values are returned as a single dimensional</span></span>
<span class="pl-s1">    <span class="pl-c">// array and multiple columns are returned as an array of arrays</span></span>
<span class="pl-s1">    <span class="pl-c">// Set style to PDO::FETCH_NAMED when values are an array</span></span>
<span class="pl-s1">    <span class="pl-c">// (i.e. there are more than two columns in the select)</span></span>
<span class="pl-s1">    <span class="pl-smi">$result</span> <span class="pl-k">=</span> <span class="pl-smi">$pdo</span><span class="pl-k">-&gt;</span>fetchGroup(<span class="pl-smi">$stm</span>, <span class="pl-smi">$bind</span>, <span class="pl-smi">$style</span> <span class="pl-k">=</span> <span class="pl-c1">PDO</span><span class="pl-k">::</span><span class="pl-c1">FETCH_COLUMN</span>)</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// fetchObject() returns the first row as an object of your choosing; the</span></span>
<span class="pl-s1">    <span class="pl-c">// columns are mapped to object properties. an optional 4th parameter array</span></span>
<span class="pl-s1">    <span class="pl-c">// provides constructor arguments when instantiating the object.</span></span>
<span class="pl-s1">    <span class="pl-smi">$result</span> <span class="pl-k">=</span> <span class="pl-smi">$pdo</span><span class="pl-k">-&gt;</span>fetchObject(<span class="pl-smi">$stm</span>, <span class="pl-smi">$bind</span>, <span class="pl-s"><span class="pl-pds">'</span>ClassName<span class="pl-pds">'</span></span>, <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>ctor_arg_1<span class="pl-pds">'</span></span>));</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// fetchObjects() returns an array of objects of your choosing; the</span></span>
<span class="pl-s1">    <span class="pl-c">// columns are mapped to object properties. an optional 4th parameter array</span></span>
<span class="pl-s1">    <span class="pl-c">// provides constructor arguments when instantiating the object.</span></span>
<span class="pl-s1">    <span class="pl-smi">$result</span> <span class="pl-k">=</span> <span class="pl-smi">$pdo</span><span class="pl-k">-&gt;</span>fetchObjects(<span class="pl-smi">$stm</span>, <span class="pl-smi">$bind</span>, <span class="pl-s"><span class="pl-pds">'</span>ClassName<span class="pl-pds">'</span></span>, <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>ctor_arg_1<span class="pl-pds">'</span></span>));</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// fetchOne() returns the first row as an associative array where the keys</span></span>
<span class="pl-s1">    <span class="pl-c">// are the column names</span></span>
<span class="pl-s1">    <span class="pl-smi">$result</span> <span class="pl-k">=</span> <span class="pl-smi">$pdo</span><span class="pl-k">-&gt;</span>fetchOne(<span class="pl-smi">$stm</span>, <span class="pl-smi">$bind</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// fetchPairs() returns an associative array where each key is the first</span></span>
<span class="pl-s1">    <span class="pl-c">// column and each value is the second column</span></span>
<span class="pl-s1">    <span class="pl-smi">$result</span> <span class="pl-k">=</span> <span class="pl-smi">$pdo</span><span class="pl-k">-&gt;</span>fetchPairs(<span class="pl-smi">$stm</span>, <span class="pl-smi">$bind</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// fetchValue() returns the value of the first row in the first column</span></span>
<span class="pl-s1">    <span class="pl-smi">$result</span> <span class="pl-k">=</span> <span class="pl-smi">$pdo</span><span class="pl-k">-&gt;</span>fetchValue(<span class="pl-smi">$stm</span>, <span class="pl-smi">$bind</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">// fetchAffected() returns the number of affected rows</span></span>
<span class="pl-s1">    <span class="pl-smi">$stm</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-k">UPDATE</span> test <span class="pl-k">SET</span> incr <span class="pl-k">=</span> incr <span class="pl-k">+</span> <span class="pl-c1">1</span> <span class="pl-k">WHERE</span> foo <span class="pl-k">=</span> :foo <span class="pl-k">AND</span> bar <span class="pl-k">=</span> :bar</span><span class="pl-pds">"</span></span>;</span>
<span class="pl-s1">    <span class="pl-smi">$row_count</span> <span class="pl-k">=</span> <span class="pl-smi">$pdo</span><span class="pl-k">-&gt;</span>fetchAffected(<span class="pl-smi">$stm</span>, <span class="pl-smi">$bind</span>);</span></pre></div>

<h5>
<a id="数组转换" class="anchor" href="#%E6%95%B0%E7%BB%84%E8%BD%AC%E6%8D%A2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>数组转换</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">    <span class="pl-smi">$pdo</span> <span class="pl-k">=</span> <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>getDefault();</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-smi">$stm</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-s1"><span class="pl-k">SELECT</span> <span class="pl-k">*</span> <span class="pl-k">FROM</span> test <span class="pl-k">WHERE</span> foo <span class="pl-k">IN</span> (:foo)</span><span class="pl-pds">'</span></span></span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-smi">$array</span> <span class="pl-k">=</span> <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>bar<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>baz<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    <span class="pl-smi">$cond</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>IN (<span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-smi">$pdo</span><span class="pl-k">-&gt;</span>quote(<span class="pl-smi">$array</span>) <span class="pl-k">.</span> <span class="pl-s"><span class="pl-pds">'</span>)<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-smi">$bind_values</span> <span class="pl-k">=</span> <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$array</span>);</span>
<span class="pl-s1">    <span class="pl-smi">$sth</span> <span class="pl-k">=</span> <span class="pl-smi">$pdo</span><span class="pl-k">-&gt;</span>perform(<span class="pl-smi">$stm</span>, <span class="pl-smi">$bind_values</span>);</span>
<span class="pl-s1">    <span class="pl-c1">echo</span> <span class="pl-smi">$sth</span><span class="pl-k">-&gt;</span><span class="pl-smi">queryString</span>;</span>
<span class="pl-s1">    <span class="pl-c">// "SELECT * FROM test WHERE foo IN ('foo', 'bar', 'baz')"</span></span></pre></div>

<h2>
<a id="视图层" class="anchor" href="#%E8%A7%86%E5%9B%BE%E5%B1%82" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>视图层</h2>

<h5>
<a id="基础的twig语法文档请查看twig官方twigsensiolabsorgdocumentation" class="anchor" href="#%E5%9F%BA%E7%A1%80%E7%9A%84twig%E8%AF%AD%E6%B3%95%E6%96%87%E6%A1%A3%E8%AF%B7%E6%9F%A5%E7%9C%8Btwig%E5%AE%98%E6%96%B9twigsensiolabsorgdocumentation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>基础的twig语法文档请查看twig官方(twig.sensiolabs.org/documentation)</h5>

<h5>
<a id="简单介绍框架内部扩展好的方法" class="anchor" href="#%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D%E6%A1%86%E6%9E%B6%E5%86%85%E9%83%A8%E6%89%A9%E5%B1%95%E5%A5%BD%E7%9A%84%E6%96%B9%E6%B3%95" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>简单介绍框架内部扩展好的方法</h5>

<pre><code>{{ asset("asset/css/bootstrap.min.css") }} asset方法主要是用于获取前端js,css文件的地址

{{ url('create_group', {'id':1}) }} 用于匹配路由,第一个参数是routing配置文件的主键，后面是参数，以数组形式

{{ render('Web:Group:Group:index') }} 在一个twig文件内部，可以render其他controller下面的模块。

{{ 1454566745|smart_time }} 时间戳转换
</code></pre>

<h5>
<a id="开启csrf验证防止跨站攻击" class="anchor" href="#%E5%BC%80%E5%90%AFcsrf%E9%AA%8C%E8%AF%81%E9%98%B2%E6%AD%A2%E8%B7%A8%E7%AB%99%E6%94%BB%E5%87%BB" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>开启csrf验证防止跨站攻击</h5>

<pre><code>//在post 请求时，如果在session.php配置文件中开启csrf_check参数，默认会检查csrf_token参数。你可以在表单中加入以下参数
&lt;form method="post" action="{{url('create_group', {'id':1})}}"&gt;

  &lt;input type="hidden" name="csrf_token" value="{{ csrf_token() }}"&gt;

  &lt;button type="submit"&gt;提交&lt;/button&gt;
&lt;/form&gt;
</code></pre>

<h2>
<a id="框架基础服务" class="anchor" href="#%E6%A1%86%E6%9E%B6%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>框架基础服务</h2>

<h2>
<a id="container" class="anchor" href="#container" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Container</h2>

<h5>
<a id="container是一个基础的容器一些系统变量会存放于这里" class="anchor" href="#container%E6%98%AF%E4%B8%80%E4%B8%AA%E5%9F%BA%E7%A1%80%E7%9A%84%E5%AE%B9%E5%99%A8%E4%B8%80%E4%BA%9B%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F%E4%BC%9A%E5%AD%98%E6%94%BE%E4%BA%8E%E8%BF%99%E9%87%8C" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Container是一个基础的容器，一些系统变量会存放于这里</h5>

<h2>
<a id="cache" class="anchor" href="#cache" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Cache</h2>

<h5>
<a id="目前只支持了redis得cache使用请在cachephp配置中配置redis" class="anchor" href="#%E7%9B%AE%E5%89%8D%E5%8F%AA%E6%94%AF%E6%8C%81%E4%BA%86redis%E5%BE%97cache%E4%BD%BF%E7%94%A8%E8%AF%B7%E5%9C%A8cachephp%E9%85%8D%E7%BD%AE%E4%B8%AD%E9%85%8D%E7%BD%AEredis" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>目前只支持了Redis得cache，使用请在cache.php配置中配置redis</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">use</span> <span class="pl-c1">Cache</span>;</span>
<span class="pl-s1">    <span class="pl-c">//key value expireTime</span></span>
<span class="pl-s1">    <span class="pl-c1">Cache</span><span class="pl-k">::</span>set(<span class="pl-s"><span class="pl-pds">'</span>ha<span class="pl-pds">'</span></span>, <span class="pl-c1">123</span>, <span class="pl-c1">60</span>);</span>
<span class="pl-s1">    <span class="pl-c">//也可以这样</span></span>
<span class="pl-s1">    <span class="pl-c1">Cache</span><span class="pl-k">::</span>redis() <span class="pl-k">-&gt;</span> set(<span class="pl-s"><span class="pl-pds">'</span>haa<span class="pl-pds">'</span></span>, <span class="pl-c1">123</span>, <span class="pl-c1">60</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c1">Cache</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>ha<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    <span class="pl-c1">Cache</span><span class="pl-k">::</span>hSet(<span class="pl-smi">$hashKey</span>, <span class="pl-smi">$key</span>, <span class="pl-smi">$data</span>, <span class="pl-smi">$expireTime</span>);</span>
<span class="pl-s1">    <span class="pl-c1">Cache</span><span class="pl-k">::</span>hGet(<span class="pl-smi">$hashKey</span>, <span class="pl-smi">$key</span>);</span>
<span class="pl-s1">    <span class="pl-c1">Cache</span><span class="pl-k">::</span>hDel(<span class="pl-smi">$hashKey</span>, <span class="pl-smi">$key</span>);</span>
<span class="pl-s1">    <span class="pl-c1">Cache</span><span class="pl-k">::</span>hDel(<span class="pl-smi">$hashKey</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">//现在的类库方法还未扩展完全，目前只有以上方法</span></span>
<span class="pl-s1">    <span class="pl-c">//你可以使用Cache::redis() 获取redis实例，这是一个PhpRedis的实例，api－》(https://github.com/phpredis/phpredis)</span></span></pre></div>

<h2>
<a id="filecache" class="anchor" href="#filecache" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>FileCache</h2>

<h5>
<a id="文件形式的缓存" class="anchor" href="#%E6%96%87%E4%BB%B6%E5%BD%A2%E5%BC%8F%E7%9A%84%E7%BC%93%E5%AD%98" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>文件形式的缓存</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">use</span> <span class="pl-c1">FileCache</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">//默认路径是放在runtime/cache/</span></span>
<span class="pl-s1">    <span class="pl-c1">FileCache</span><span class="pl-k">::</span>set(<span class="pl-s"><span class="pl-pds">'</span>test.php<span class="pl-pds">'</span></span>, [<span class="pl-s"><span class="pl-pds">'</span>testdfata<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>datadata<span class="pl-pds">'</span></span>]);</span>
<span class="pl-s1">    <span class="pl-c">//指定路径</span></span>
<span class="pl-s1">    <span class="pl-c1">FileCache</span><span class="pl-k">::</span>set(<span class="pl-s"><span class="pl-pds">'</span>test.php<span class="pl-pds">'</span></span>, [<span class="pl-s"><span class="pl-pds">'</span>testdfata<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>datadata<span class="pl-pds">'</span></span>], <span class="pl-s"><span class="pl-pds">'</span>runtime/cache/test/<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c1">FileCache</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>test.php<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    <span class="pl-c1">FileCache</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>test.php<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>runtime/cache/test/<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span></pre></div>

<h2>
<a id="config" class="anchor" href="#config" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Config</h2>

<h5>
<a id="用于查找config目录下得配置" class="anchor" href="#%E7%94%A8%E4%BA%8E%E6%9F%A5%E6%89%BEconfig%E7%9B%AE%E5%BD%95%E4%B8%8B%E5%BE%97%E9%85%8D%E7%BD%AE" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>用于查找config目录下得配置</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">use</span> <span class="pl-c1">Config</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">//文件名::key</span></span>
<span class="pl-s1">    <span class="pl-c1">Config</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>app::environment<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">//也可以重新设置ests</span></span>
<span class="pl-s1">    <span class="pl-c1">Config</span><span class="pl-k">::</span>set(<span class="pl-s"><span class="pl-pds">'</span>app<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>environment<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>dev<span class="pl-pds">'</span></span>);</span></pre></div>

<h2>
<a id="eventdispatcher" class="anchor" href="#eventdispatcher" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>EventDispatcher</h2>

<h5>
<a id="事件监听listener" class="anchor" href="#%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AClistener" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>事件监听Listener</h5>

<h5>
<a id="先写一个监听kernalresponselistener" class="anchor" href="#%E5%85%88%E5%86%99%E4%B8%80%E4%B8%AA%E7%9B%91%E5%90%ACkernalresponselistener" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>先写一个监听KernalResponseListener</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">src\web\Listeners</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">Listener</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">Event</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">KernalResponseListener</span> <span class="pl-k">extends</span> <span class="pl-e">Listener</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">setMethod</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>onKernalResponse<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">//触发时执行</span></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">onKernalResponse</span>(<span class="pl-c1">Event</span> <span class="pl-smi">$event</span>)</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>this is a KernalResponse Listener<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span></pre></div>

<h5>
<a id="绑定监听" class="anchor" href="#%E7%BB%91%E5%AE%9A%E7%9B%91%E5%90%AC" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>绑定监听</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">use</span> <span class="pl-c1">EventDispatcher</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-smi">$listener</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">KernalResponseListener</span>();</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">//定义一个事件名称，触发的监听器，和一个重要指数</span></span>
<span class="pl-s1">    <span class="pl-c1">EventDispatcher</span><span class="pl-k">::</span>addListener(<span class="pl-s"><span class="pl-pds">'</span>kernal.responese<span class="pl-pds">'</span></span>, <span class="pl-smi">$listener</span>, <span class="pl-c1">10</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c1">EventDispatcher</span><span class="pl-k">::</span>removeListener(<span class="pl-s"><span class="pl-pds">'</span>kernal.responese<span class="pl-pds">'</span></span>, <span class="pl-smi">$listener</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c1">EventDispatcher</span><span class="pl-k">::</span>hasListeners(<span class="pl-s"><span class="pl-pds">'</span>kernal.responese<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">//最后可以在需要的时候派发事件</span></span>
<span class="pl-s1">    <span class="pl-c1">EventDispatcher</span><span class="pl-k">::</span>dispatch(<span class="pl-s"><span class="pl-pds">'</span>kernal.responese<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    <span class="pl-c1">EventDispatcher</span><span class="pl-k">::</span>dispatch(<span class="pl-s"><span class="pl-pds">'</span>kernal.responese<span class="pl-pds">'</span></span>, <span class="pl-smi">$envet</span>);</span>
<span class="pl-s1"></span></pre></div>

<h5>
<a id="事件绑定器subscriber" class="anchor" href="#%E4%BA%8B%E4%BB%B6%E7%BB%91%E5%AE%9A%E5%99%A8subscriber" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>事件绑定器Subscriber</h5>

<h5>
<a id="写一个subscriber" class="anchor" href="#%E5%86%99%E4%B8%80%E4%B8%AAsubscriber" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>写一个subscriber</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">use</span> <span class="pl-c1">Group\Events\EventSubscriberInterface</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">class</span> <span class="pl-en">TestSubscriber</span> <span class="pl-k">implements</span> <span class="pl-e">EventSubscriberInterface</span></span>
<span class="pl-s1">    {   </span>
<span class="pl-s1">        <span class="pl-c">//注册多个监听事件</span></span>
<span class="pl-s1">        <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">getSubscribedEvents</span>()</span>
<span class="pl-s1">        {</span>
<span class="pl-s1">            <span class="pl-k">return</span> [</span>
<span class="pl-s1"></span>
<span class="pl-s1">                <span class="pl-c">//eventName  =&gt;  listener</span></span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">'</span>test.start<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>onTestStart<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">                <span class="pl-c">//eventName  =&gt;  listener, priority</span></span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">'</span>test.stop<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [<span class="pl-s"><span class="pl-pds">'</span>onTestStop<span class="pl-pds">'</span></span>, <span class="pl-c1">100</span>],</span>
<span class="pl-s1">                <span class="pl-c">//eventName  =&gt; array  listener, priority</span></span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">'</span>test.doing<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">                    [<span class="pl-s"><span class="pl-pds">'</span>onDoA<span class="pl-pds">'</span></span>],</span>
<span class="pl-s1">                    [<span class="pl-s"><span class="pl-pds">'</span>onDoB<span class="pl-pds">'</span></span>, <span class="pl-c1">225</span>],</span>
<span class="pl-s1">                ],</span>
<span class="pl-s1">            ];</span>
<span class="pl-s1">        }</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">onTestStart</span>(<span class="pl-c1">\Event</span> <span class="pl-smi">$event</span>)</span>
<span class="pl-s1">        {</span>
<span class="pl-s1">            <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>onTestStart<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">        }</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">onTestStop</span>(<span class="pl-c1">\Event</span> <span class="pl-smi">$event</span>)</span>
<span class="pl-s1">        {</span>
<span class="pl-s1">            <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>onTestStop<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">        }</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">onDoA</span>(<span class="pl-c1">\Event</span> <span class="pl-smi">$event</span>)</span>
<span class="pl-s1">        {</span>
<span class="pl-s1">            <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>onDoA<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">        }</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">onDoB</span>(<span class="pl-c1">\Event</span> <span class="pl-smi">$event</span>)</span>
<span class="pl-s1">        {</span>
<span class="pl-s1">            <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>onDoB<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">        }</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span></pre></div>

<h5>
<a id="添加到eventdispatcher" class="anchor" href="#%E6%B7%BB%E5%8A%A0%E5%88%B0eventdispatcher" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>添加到EventDispatcher</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">        <span class="pl-smi">$subscriber</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">TestSubscriber</span>();</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-c1">EventDispatcher</span><span class="pl-k">::</span>addSubscriber(<span class="pl-smi">$subscriber</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-c1">EventDispatcher</span><span class="pl-k">::</span>hasListeners(<span class="pl-s"><span class="pl-pds">'</span>test.start<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">        <span class="pl-c1">EventDispatcher</span><span class="pl-k">::</span>hasListeners(<span class="pl-s"><span class="pl-pds">'</span>test.stop<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">        <span class="pl-c1">EventDispatcher</span><span class="pl-k">::</span>hasListeners(<span class="pl-s"><span class="pl-pds">'</span>test.doing<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-c1">EventDispatcher</span><span class="pl-k">::</span>dispatch(<span class="pl-s"><span class="pl-pds">'</span>test.start<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        <span class="pl-c1">EventDispatcher</span><span class="pl-k">::</span>dispatch(<span class="pl-s"><span class="pl-pds">'</span>test.stop<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        <span class="pl-c1">EventDispatcher</span><span class="pl-k">::</span>dispatch(<span class="pl-s"><span class="pl-pds">'</span>test.doing<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-c1">EventDispatcher</span><span class="pl-k">::</span>removeSubscriber(<span class="pl-smi">$subscriber</span>);</span></pre></div>

<h2>
<a id="request" class="anchor" href="#request" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Request</h2>

<h5>
<a id="参照symfony2的request服务" class="anchor" href="#%E5%8F%82%E7%85%A7symfony2%E7%9A%84request%E6%9C%8D%E5%8A%A1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>参照symfony2的Request服务</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">testAction</span>(<span class="pl-c1">Request</span> <span class="pl-smi">$request</span>, <span class="pl-smi">$id</span>)</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-c">//get</span></span>
<span class="pl-s1">        <span class="pl-smi">$request</span> <span class="pl-k">-&gt;</span> <span class="pl-c1">query</span> <span class="pl-k">-&gt;</span> get(<span class="pl-s"><span class="pl-pds">'</span>xxx<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        <span class="pl-smi">$request</span> <span class="pl-k">-&gt;</span> <span class="pl-c1">query</span> <span class="pl-k">-&gt;</span> all()</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-c">//post</span></span>
<span class="pl-s1">        <span class="pl-smi">$request</span> <span class="pl-k">-&gt;</span> <span class="pl-c1">request</span> <span class="pl-k">-&gt;</span> get(<span class="pl-s"><span class="pl-pds">'</span>xxx<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        <span class="pl-smi">$request</span> <span class="pl-k">-&gt;</span> <span class="pl-c1">request</span> <span class="pl-k">-&gt;</span> all()</span>
<span class="pl-s1"></span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-c">//file </span></span>
<span class="pl-s1">        <span class="pl-smi">$request</span> <span class="pl-k">-&gt;</span> <span class="pl-c1">file</span> <span class="pl-k">-&gt;</span> get(<span class="pl-s"><span class="pl-pds">'</span>xxxx<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    }</span></pre></div>

<h2>
<a id="response" class="anchor" href="#response" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Response</h2>

<h5>
<a id="常规" class="anchor" href="#%E5%B8%B8%E8%A7%84" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>常规</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">testAction</span>(<span class="pl-c1">Request</span> <span class="pl-smi">$request</span>, <span class="pl-smi">$id</span>)</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">\</span><span class="pl-c1">Response</span>(<span class="pl-s"><span class="pl-pds">'</span>这是文本<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    }</span></pre></div>

<h5>
<a id="json格式" class="anchor" href="#json%E6%A0%BC%E5%BC%8F" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>json格式</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">testAction</span>(<span class="pl-c1">Request</span> <span class="pl-smi">$request</span>, <span class="pl-smi">$id</span>)</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">\</span><span class="pl-c1">JsonResponse</span>(<span class="pl-s"><span class="pl-pds">'</span>这是文本<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    }</span></pre></div>

<h5>
<a id="重定向" class="anchor" href="#%E9%87%8D%E5%AE%9A%E5%90%91" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>重定向</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">testAction</span>(<span class="pl-c1">Request</span> <span class="pl-smi">$request</span>, <span class="pl-smi">$id</span>)</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-smi">$this</span> <span class="pl-k">-&gt;</span> redirect(<span class="pl-s"><span class="pl-pds">'</span>http://xxxx<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    }</span></pre></div>

<h2>
<a id="session" class="anchor" href="#session" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Session</h2>

<h5>
<a id="session-目前支持2中方式存储默认存放在runtimesessions下也可以开启redis-driver将session存在redis中详见配置" class="anchor" href="#session-%E7%9B%AE%E5%89%8D%E6%94%AF%E6%8C%812%E4%B8%AD%E6%96%B9%E5%BC%8F%E5%AD%98%E5%82%A8%E9%BB%98%E8%AE%A4%E5%AD%98%E6%94%BE%E5%9C%A8runtimesessions%E4%B8%8B%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%BC%80%E5%90%AFredis-driver%E5%B0%86session%E5%AD%98%E5%9C%A8redis%E4%B8%AD%E8%AF%A6%E8%A7%81%E9%85%8D%E7%BD%AE" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Session 目前支持2中方式存储，默认存放在runtime/sessions下，也可以开启redis driver，将session存在redis中，详见配置</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">use</span> <span class="pl-c1">Session</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c1">Session</span><span class="pl-k">::</span>set(<span class="pl-s"><span class="pl-pds">'</span>group<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>good<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    <span class="pl-c1">Session</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>group<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    <span class="pl-c1">Session</span><span class="pl-k">::</span>remove(<span class="pl-s"><span class="pl-pds">'</span>group<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    <span class="pl-c1">Session</span><span class="pl-k">::</span>has(<span class="pl-s"><span class="pl-pds">'</span>group<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    <span class="pl-c1">Session</span><span class="pl-k">::</span>clear();</span>
<span class="pl-s1">    <span class="pl-c1">Session</span><span class="pl-k">::</span>all();</span>
<span class="pl-s1">    <span class="pl-c1">Session</span><span class="pl-k">::</span>isStarted();</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-smi">$attributes</span> <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>group<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>hello<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">    <span class="pl-c1">Session</span><span class="pl-k">::</span>replace(<span class="pl-smi">$attributes</span>);</span></pre></div>

<h2>
<a id="log" class="anchor" href="#log" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Log</h2>

<h5>
<a id="默认存放于runtimelog" class="anchor" href="#%E9%BB%98%E8%AE%A4%E5%AD%98%E6%94%BE%E4%BA%8Eruntimelog" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>默认存放于runtime/log</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">use</span> <span class="pl-c1">Log</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c1">Log</span><span class="pl-k">::</span>debug(<span class="pl-s"><span class="pl-pds">'</span>123<span class="pl-pds">'</span></span>,[<span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span><span class="pl-k">=&gt;</span><span class="pl-c1">1</span>]);</span>
<span class="pl-s1">    <span class="pl-c1">Log</span><span class="pl-k">::</span>info(<span class="pl-s"><span class="pl-pds">'</span>123<span class="pl-pds">'</span></span>,[<span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span><span class="pl-k">=&gt;</span><span class="pl-c1">1</span>]);</span>
<span class="pl-s1">    <span class="pl-c1">Log</span><span class="pl-k">::</span>notice(<span class="pl-s"><span class="pl-pds">'</span>123<span class="pl-pds">'</span></span>,[<span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span><span class="pl-k">=&gt;</span><span class="pl-c1">1</span>]);</span>
<span class="pl-s1">    <span class="pl-c1">Log</span><span class="pl-k">::</span>warning(<span class="pl-s"><span class="pl-pds">'</span>123<span class="pl-pds">'</span></span>,[<span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span><span class="pl-k">=&gt;</span><span class="pl-c1">1</span>]);</span>
<span class="pl-s1">    <span class="pl-c1">Log</span><span class="pl-k">::</span>error(<span class="pl-s"><span class="pl-pds">'</span>123<span class="pl-pds">'</span></span>,[<span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span><span class="pl-k">=&gt;</span><span class="pl-c1">1</span>]);</span>
<span class="pl-s1">    <span class="pl-c1">Log</span><span class="pl-k">::</span>critical(<span class="pl-s"><span class="pl-pds">'</span>123<span class="pl-pds">'</span></span>,[<span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span><span class="pl-k">=&gt;</span><span class="pl-c1">1</span>]);</span>
<span class="pl-s1">    <span class="pl-c1">Log</span><span class="pl-k">::</span>alert(<span class="pl-s"><span class="pl-pds">'</span>123<span class="pl-pds">'</span></span>,[<span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span><span class="pl-k">=&gt;</span><span class="pl-c1">1</span>]);</span>
<span class="pl-s1">    <span class="pl-c1">Log</span><span class="pl-k">::</span>emergency(<span class="pl-s"><span class="pl-pds">'</span>123<span class="pl-pds">'</span></span>,[<span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span><span class="pl-k">=&gt;</span><span class="pl-c1">1</span>]);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">//默认model是web.app,也可以自定义</span></span>
<span class="pl-s1">    <span class="pl-c1">Log</span><span class="pl-k">::</span>emergency(<span class="pl-s"><span class="pl-pds">'</span>123<span class="pl-pds">'</span></span>,[<span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span><span class="pl-k">=&gt;</span><span class="pl-c1">1</span>],<span class="pl-s"><span class="pl-pds">'</span>web.admin<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span></pre></div>

<h2>
<a id="console" class="anchor" href="#console" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Console</h2>

<h4>
<a id="控制台的使用方法" class="anchor" href="#%E6%8E%A7%E5%88%B6%E5%8F%B0%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>控制台的使用方法</h4>

<pre><code>//进入根目录 执行
app/console


----------------------------------------------------------

     -----        ----      ----      |     |   / ----
    /          | /        |      |    |     |   |      |
    |          |          |      |    |     |   | ----/
    |   ----   |          |      |    |     |   |
     -----|    |            ----       ----     |

 ----------------------------------------------------------

 使用帮助: 
 Usage: app/console [options] [args...] 

 generate:service name       生成一个自定义service
 generate:controller  name    生成一个自定义controller
 sql:generate                生成一个sql执行模板(存放于app/sql)
 sql:clean                清除lock文件,您可以再次执行migrate脚本中的命令
 sql:migrate   [default|write|read|all] [name]  参数可不填，执行sql模板(默认会向default服务器执行.第二个参数只有当第一个参数为write|read时，才会生效,如果不填，默认为write|read下面所有服务器)
 sql:rollback   [default|write|read|all] [name]  参数可不填，执行sql模板(默认会向default服务器执行.第二个参数只有当第一个参数为write|read时，才会生效,如果不填，默认为write|read下面所有服务器)
</code></pre>

<h4>
<a id="自定义控制台" class="anchor" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E5%88%B6%E5%8F%B0" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>自定义控制台</h4>

<h5>
<a id="配置文件configappphp" class="anchor" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6configappphp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>配置文件config/app.php</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">    <span class="pl-c">//扩展console命令行控制台</span></span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>console_commands<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>log:clear<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>command<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>src\Web\Command\LogClearCommand<span class="pl-pds">'</span></span>, <span class="pl-c">//执行的类</span></span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>help<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>清除日志<span class="pl-pds">'</span></span>, <span class="pl-c">//提示</span></span>
<span class="pl-s1">        ],</span>
<span class="pl-s1">    ],</span></pre></div>

<h2>
<a id="cronjob" class="anchor" href="#cronjob" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>CronJob</h2>

<h5>
<a id="异步定时器介绍目前只支持秒级定时基本涉及到毫秒定时的业务很少" class="anchor" href="#%E5%BC%82%E6%AD%A5%E5%AE%9A%E6%97%B6%E5%99%A8%E4%BB%8B%E7%BB%8D%E7%9B%AE%E5%89%8D%E5%8F%AA%E6%94%AF%E6%8C%81%E7%A7%92%E7%BA%A7%E5%AE%9A%E6%97%B6%E5%9F%BA%E6%9C%AC%E6%B6%89%E5%8F%8A%E5%88%B0%E6%AF%AB%E7%A7%92%E5%AE%9A%E6%97%B6%E7%9A%84%E4%B8%9A%E5%8A%A1%E5%BE%88%E5%B0%91" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>异步定时器介绍(目前只支持秒级定时,基本涉及到毫秒定时的业务很少)</h5>

<h5>
<a id="依赖swoole1714以上版本" class="anchor" href="#%E4%BE%9D%E8%B5%96swoole1714%E4%BB%A5%E4%B8%8A%E7%89%88%E6%9C%AC" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>依赖：<a href="https://github.com/swoole/swoole-src">Swoole1.7.14以上版本</a>
</h5>

<h5>
<a id="配置文件configcronphp" class="anchor" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6configcronphp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>配置文件config/cron.php</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">    <span class="pl-k">return</span> [</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>cache_dir<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>runtime/cron<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>class_cache<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>runtime/cron/bootstrap.class.cache<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-c">//log路径</span></span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>log_dir<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>runtime/cron<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-c">//定时器轮询周期，精确到毫秒</span></span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>tick_time<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">1000</span>,</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>job<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1"></span>
<span class="pl-s1">            [</span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>TestLog<span class="pl-pds">'</span></span>,<span class="pl-c">//任务名</span></span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">'</span>time<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>*/1 * * * *<span class="pl-pds">'</span></span>,<span class="pl-c">//定时规则 分 小时 天 周 月</span></span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">'</span>command<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>src\Web\Cron\Test<span class="pl-pds">'</span></span>,<span class="pl-c">//执行的类库</span></span>
<span class="pl-s1">            ],</span>
<span class="pl-s1"></span>
<span class="pl-s1">            [</span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>testCache<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">'</span>time<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>24 */2 * * *<span class="pl-pds">'</span></span>,<span class="pl-c">//定时规则 分 小时 天 周 月</span></span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">'</span>command<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>src\Web\Cron\TestCache<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">            ],</span>
<span class="pl-s1"></span>
<span class="pl-s1">            [</span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>testSql<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">'</span>time<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>*/2 * * * *<span class="pl-pds">'</span></span>,<span class="pl-c">//定时规则 分 小时 天 周 月</span></span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">'</span>command<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>src\Web\Cron\TestSql<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">            ],</span>
<span class="pl-s1"></span>
<span class="pl-s1">        ],</span>
<span class="pl-s1">    ];</span></pre></div>

<h5>
<a id="执行的类库示例" class="anchor" href="#%E6%89%A7%E8%A1%8C%E7%9A%84%E7%B1%BB%E5%BA%93%E7%A4%BA%E4%BE%8B" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>执行的类库示例</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">namespace</span> <span class="pl-en">src\Web\Cron</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">use</span> <span class="pl-c1">Group\Cron\CronJob</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">//继承CronJob父类</span></span>
<span class="pl-s1">    <span class="pl-k">class</span> <span class="pl-en">Test</span> <span class="pl-k">extends</span> <span class="pl-e">CronJob</span></span>
<span class="pl-s1">    {   </span>
<span class="pl-s1">        <span class="pl-c">//实现handle方法即可  框架内部所有服务都可正常使用</span></span>
<span class="pl-s1">        <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">handle</span>()</span>
<span class="pl-s1">        {</span>
<span class="pl-s1">            <span class="pl-c1">\</span><span class="pl-c1">Log</span><span class="pl-k">::</span>info(<span class="pl-s"><span class="pl-pds">'</span>nihao<span class="pl-pds">'</span></span>, [<span class="pl-s"><span class="pl-pds">'</span>time<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">date</span>(<span class="pl-s"><span class="pl-pds">'</span>Y-m-d H:i:s<span class="pl-pds">'</span></span>, <span class="pl-c1">time</span>())], <span class="pl-s"><span class="pl-pds">'</span>cron.job<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    }</span></pre></div>

<h5>
<a id="执行命令" class="anchor" href="#%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>执行命令</h5>

<pre><code>app/cron start|restart|stop|status|exec (job name)
</code></pre>

<h2>
<a id="queue" class="anchor" href="#queue" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Queue</h2>

<h5>
<a id="异步队列服务介绍" class="anchor" href="#%E5%BC%82%E6%AD%A5%E9%98%9F%E5%88%97%E6%9C%8D%E5%8A%A1%E4%BB%8B%E7%BB%8D" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>异步队列服务介绍</h5>

<h5>
<a id="依赖swoole1714以上版本-1" class="anchor" href="#%E4%BE%9D%E8%B5%96swoole1714%E4%BB%A5%E4%B8%8A%E7%89%88%E6%9C%AC-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>依赖：<a href="https://github.com/swoole/swoole-src">Swoole1.7.14以上版本</a>
</h5>

<h5>
<a id="依赖beanstalkd" class="anchor" href="#%E4%BE%9D%E8%B5%96beanstalkd" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>依赖：<a href="https://github.com/kr/beanstalkd">beanstalkd</a>
</h5>

<h5>
<a id="向队列插入任务" class="anchor" href="#%E5%90%91%E9%98%9F%E5%88%97%E6%8F%92%E5%85%A5%E4%BB%BB%E5%8A%A1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>向队列插入任务</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">use</span> <span class="pl-c1">Queue</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">//队列名</span></span>
<span class="pl-s1">    <span class="pl-smi">$tube</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>testjob1<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">    <span class="pl-c">//具体数据</span></span>
<span class="pl-s1">    <span class="pl-smi">$data</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>这是第一个队列任务<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">    <span class="pl-c">//就这么简单 队列已经被塞入内存</span></span>
<span class="pl-s1">    <span class="pl-c">//$priority, $delaytime, $lifetime 可不填。默认会取配置的参数</span></span>
<span class="pl-s1">    <span class="pl-smi">$priority</span> <span class="pl-k">=</span> <span class="pl-c1">1</span>;</span>
<span class="pl-s1">    <span class="pl-smi">$delaytime</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>;</span>
<span class="pl-s1">    <span class="pl-smi">$lifetime</span> <span class="pl-k">=</span> <span class="pl-c1">60</span>;</span>
<span class="pl-s1">    <span class="pl-c1">Queue</span><span class="pl-k">::</span>put(<span class="pl-smi">$tube</span>, <span class="pl-smi">$data</span>, <span class="pl-smi">$priority</span>, <span class="pl-smi">$delaytime</span>, <span class="pl-smi">$lifetime</span>);</span>
<span class="pl-s1"></span></pre></div>

<h5>
<a id="配置configqueuephp" class="anchor" href="#%E9%85%8D%E7%BD%AEconfigqueuephp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>配置config/queue.php</h5>

<h5>
<a id="开启异步队列服务处理任务" class="anchor" href="#%E5%BC%80%E5%90%AF%E5%BC%82%E6%AD%A5%E9%98%9F%E5%88%97%E6%9C%8D%E5%8A%A1%E5%A4%84%E7%90%86%E4%BB%BB%E5%8A%A1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>开启异步队列服务处理任务</h5>

<pre><code>app/queue start|restart|stop
</code></pre>

<h5>
<a id="最后看看我们的任务怎么写" class="anchor" href="#%E6%9C%80%E5%90%8E%E7%9C%8B%E7%9C%8B%E6%88%91%E4%BB%AC%E7%9A%84%E4%BB%BB%E5%8A%A1%E6%80%8E%E4%B9%88%E5%86%99" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>最后看看我们的任务怎么写</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">    <span class="pl-k">&lt;</span>?<span class="pl-c1">php</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">src\Web\Queue</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">Group\Queue\QueueJob</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">TestJob</span> <span class="pl-k">extends</span> <span class="pl-e">QueueJob</span></span>
<span class="pl-s1">{   </span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">handle</span>()</span>
<span class="pl-s1">    {      </span>
<span class="pl-s1">        <span class="pl-c">//队列任务的id号</span></span>
<span class="pl-s1">        <span class="pl-smi">$jobId</span> <span class="pl-k">=</span> <span class="pl-smi">$this</span> <span class="pl-k">-&gt;</span> <span class="pl-c1">jobId</span>;</span>
<span class="pl-s1">        <span class="pl-c">//你在插入队列时的数据</span></span>
<span class="pl-s1">        <span class="pl-smi">$jobData</span> <span class="pl-k">=</span> <span class="pl-smi">$this</span> <span class="pl-k">-&gt;</span> <span class="pl-c1">jobData</span>;</span>
<span class="pl-s1">        <span class="pl-c">//后面就可以写处理的逻辑了</span></span>
<span class="pl-s1">        <span class="pl-c1">\</span><span class="pl-c1">Log</span><span class="pl-k">::</span>info(<span class="pl-s"><span class="pl-pds">'</span>queue handle job<span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-smi">$this</span> <span class="pl-k">-&gt;</span> <span class="pl-c1">jobId</span>, [<span class="pl-s"><span class="pl-pds">'</span>time<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">date</span>(<span class="pl-s"><span class="pl-pds">'</span>Y-m-d H:i:s<span class="pl-pds">'</span></span>, <span class="pl-c1">time</span>())], <span class="pl-s"><span class="pl-pds">'</span>queue.job<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">}</span></pre></div>

<h5>
<a id="队列图形化管理工具beanstalk_console" class="anchor" href="#%E9%98%9F%E5%88%97%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7beanstalk_console" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>队列图形化管理工具<a href="https://github.com/ptrofimov/beanstalk_console">beanstalk_console</a>
</h5>

<h2>
<a id="rpc" class="anchor" href="#rpc" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RPC</h2>

<h5>
<a id="一个启动命令完成rpc服务不与其他业务冲突" class="anchor" href="#%E4%B8%80%E4%B8%AA%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4%E5%AE%8C%E6%88%90rpc%E6%9C%8D%E5%8A%A1%E4%B8%8D%E4%B8%8E%E5%85%B6%E4%BB%96%E4%B8%9A%E5%8A%A1%E5%86%B2%E7%AA%81" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>一个启动命令完成rpc服务！！不与其他业务冲突！！</h5>

<h5>
<a id="依赖swoole" class="anchor" href="#%E4%BE%9D%E8%B5%96swoole" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>依赖：<a href="https://github.com/swoole/swoole-src">Swoole</a>
</h5>

<h5>
<a id="启用configappphp-中的serviceproviders里面的rpcserviceprovider" class="anchor" href="#%E5%90%AF%E7%94%A8configappphp-%E4%B8%AD%E7%9A%84serviceproviders%E9%87%8C%E9%9D%A2%E7%9A%84rpcserviceprovider" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>启用config/app.php 中的serviceProviders里面的RpcServiceProvider</h5>

<h5>
<a id="配置configrpcphp文件" class="anchor" href="#%E9%85%8D%E7%BD%AEconfigrpcphp%E6%96%87%E4%BB%B6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>配置config/rpc.php文件,</h5>

<h5>
<a id="服务启动-php-rpc_serverphp-" class="anchor" href="#%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8-php-rpc_serverphp-" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>服务启动 php rpc_server.php &amp;</h5>

<h5>
<a id="服务热重启-php-rpc_serverphp--s-reload" class="anchor" href="#%E6%9C%8D%E5%8A%A1%E7%83%AD%E9%87%8D%E5%90%AF-php-rpc_serverphp--s-reload" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>服务热重启 php rpc_server.php -s reload</h5>

<h5>
<a id="注意服务会默认开放srcservices下面所有服务的公有函数的调用" class="anchor" href="#%E6%B3%A8%E6%84%8F%E6%9C%8D%E5%8A%A1%E4%BC%9A%E9%BB%98%E8%AE%A4%E5%BC%80%E6%94%BEsrcservices%E4%B8%8B%E9%9D%A2%E6%89%80%E6%9C%89%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%85%AC%E6%9C%89%E5%87%BD%E6%95%B0%E7%9A%84%E8%B0%83%E7%94%A8" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>注意服务会默认开放src/Services下面所有服务的公有函数的调用</h5>

<h5>
<a id="使用" class="anchor" href="#%E4%BD%BF%E7%94%A8" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>使用</h5>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">//指调用User模块下UserService 的getUser方法， 最后跟上参数</span></span>
<span class="pl-s1">    <span class="pl-smi">$res</span> <span class="pl-k">=</span> <span class="pl-c1">\</span><span class="pl-c1">Rpc</span><span class="pl-k">::</span>call(<span class="pl-s"><span class="pl-pds">'</span>User:User<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>getUser<span class="pl-pds">'</span></span>, [<span class="pl-c1">1</span>]);</span>
<span class="pl-s1">    <span class="pl-c">//错误返回false</span></span>
<span class="pl-s1">    <span class="pl-c1">var_dump</span>(<span class="pl-smi">$res</span>);</span>
<span class="pl-s1"></span></pre></div>

<h5>
<a id="用途做soa服务化管理时用于分布式" class="anchor" href="#%E7%94%A8%E9%80%94%E5%81%9Asoa%E6%9C%8D%E5%8A%A1%E5%8C%96%E7%AE%A1%E7%90%86%E6%97%B6%E7%94%A8%E4%BA%8E%E5%88%86%E5%B8%83%E5%BC%8F" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>用途，做soa服务化管理时。用于分布式。</h5>

<h2>
<a id="单元测试" class="anchor" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>单元测试</h2>

<pre><code>phpunit --bootstrap app/test.php src
</code></pre>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
